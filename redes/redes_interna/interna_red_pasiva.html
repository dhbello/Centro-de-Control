<!DOCTYPE html>
<html lang="en">
  <head>
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-JB8FKBC408"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());
      gtag("config", "G-JB8FKBC408");
    </script>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Centro de Control Geod&eacute;sico Nacional</title>
    <link rel="icon" href="/images/favicon.png">
    <link
      rel="stylesheet"
      href="https://pro.fontawesome.com/releases/v5.10.0/css/all.css"
      integrity="sha384-AYmEC3Yw5cVb3ZcuHtOA93w35dYTsvhLPVnYs9eStHfGJvOvKxVfELGroGkvsg+p"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
      integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T"
      crossorigin="anonymous"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.css"
    />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <link href="../../css/style.css" rel="stylesheet" />
    <link href="/css/navbar-footer.css" rel="stylesheet">
    <link href="../../css/maestra.css" rel="stylesheet" />
  </head>
  <body class="main redes geodesicaMaestra redActivaPagina">
    <!-- header -->
    <div class="barra_gov">
      <a class="logo-gov" href="https://www.gov.co/home/" target="_blank">
          <img alt="Logo Gov.co" src="/images/nav/header_govco.png">
      </a>
    </div>
    <div class="navbarIgacContainer origen"></div>
    <nav class="nav nav-underline"></nav>

    <div class="contenido-imprimir">
    
    <section class="portada-igac portadaSub redActiva origen mt-4">
      <div class="container block-igac">
        <a class="get-back" href="../red_geodesica.html">
          <img src="/images/iconos/arrow-back.svg" alt="" />
          Volver a la Red Geodésica GNSS
        </a>
        <div class="d-flex contenido-portada">
          <div class="texto-portada">
            <h1 id="titulo"></h1>
            <div class="title" id="depto"></div>
            <div class="title" id="muni"></div>
          </div>
        </div>
      </div>
    </section>
    <div class="container containerIgac infoUbicacionContainer">
      <div class="row">
        <div class="col-md-6">
          <section class="section infoUbicacion">
            <h3 class="h3" id="nomenclatura_estandarizada">Nomenclatura Estandarizada</h3>
            <div class="title" id="departamento"></div>
            <div class="item" id="municipio"></div>
            <div class="item" id="barrio">Vereda/Barrio: Sin información</div>
            <div class="item" id="localizacion"></div>
          </section>
          <div class="divider"></div>
          <section class="section infoUbicacion pt-0">
            <div class="title">Coordenadas Navegadas MAGNA SIRGAS</div>
            <div class="item" id="latitud"></div>
            <div class="item" id="longitud"></div>
            <div class="item" id="altura"></div>
            <br>
            <div class="item" id="latitudGrados">Latitud (φ): Sin información</div>
            <div class="item" id="longitudGrados">Longitud (ג): Sin información</div>
       
          </section>
          <div class="divider"></div>
          <section class="section infoUbicacion pt-0">
            <div class="title">Monumentación</div>
            <div class="item" id="tipo_materializacion">Tipo de Monumento:</div>
            <div class="item" id="fecha_materializacion">
              Fecha fecha_materializacion:
            </div>
            <div class="item" id="fecha_descripcion">
              Fecha Descripción:
            </div>
            <div class="item" id="monumentado_por">
              Monumentado Por:
            </div>
            <div class="item" id="altura_mts">
              Altura mts:
            </div>
            <div class="item" id="largo_mts">
              Largo mts:
            </div>
            <div class="item" id="ancho_mts">
              Ancho mts:
            </div>
            <div class="item" id="actualizo">
              Elaboró/Actualizó:
            </div>           
         
            <div class="item" id="divipola2"></div>
          </section>

          <div class="divider"></div>
          <section class="section infoUbicacion pt-0">
            <div class="title">Descripción Detallada</div>
            <div class="item" id="descripcion_detallada">Sin información</div>            
          </section>

          <div class="divider"></div>
          <section class="section infoUbicacion pt-0">
            <div class="title">Observación</div>
            <div class="item" id="observacion">Sin información</div>            
          </section>

        </div>
        <div class="col-md-6">
          <section class="section infoUbicacion pb-0">
            <h3 class="h3">Nomenclatura Placa</h3>
            <div class="row" id="fotos">
              <div class="col-md-6 mt-4">
                <div class="title">Croquis General</div>
                <div class="item" onclick="activarImagen(event)" style="cursor: pointer;" id="img_croquis" ></div>
              </div>
              <div class="col-md-6 mt-4">
                <div class="title">Croquis detallado</div>
                <div class="item" onclick="activarImagen(event)" style="cursor: pointer;" id="img_detallado" ></div>
              </div>
              <div class="col-md-6 mt-4">
                <div class="title">Perfil</div>
                <div class="item" onclick="activarImagen(event)" style="cursor: pointer;" id="img_perfil" ></div>
              </div>
              <div class="col-md-6 mt-4">
                <div class="title">Acceso general</div>
                <div class="item" id="acceso_general">                 
                  Sin información
                </div>
              </div>
            </div>

            <div class="row" id="fotos">
              <div class="col-md-6 mt-4">
                <div class="title">Diagrama de obstaculos</div>
                <div class="item" onclick="activarImagen(event)" style="cursor: pointer;" id="img_obstaculos" ></div>
              </div>
              <div class="col-md-6 mt-4">
                <div class="title">Imagen de la placa</div>
                <div class="item" onclick="activarImagen(event)" style="cursor: pointer;" id="img_placa" ></div>
              </div>
            </div>

            <section class="section infoUbicacion pt-0">
              <div class="title">
                Referencia medidas de los objetos al punto
              </div>
              <table id="tbl_puntos" class="customeTable">
                <tr>
                  <th>N°</th>
                  <th>Objeto</th>
                  <th>Azimut Magnético(°)</th>
                  <th>Distancia (m)</th>
                </tr>
              </table>
            </section>
          </section>
        </div>
       

  <!-- Modal -->
  <div class="modal fade" style="background-color: rgba(34,34,34,0.75);" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content" style="width:560px; height:600px; background-color:transparent; border: 0;">
        
        <div class="modal-body" style="padding: 2rem; color:rgb(78, 73, 73)">
<!-- ================================ CARRUSEL ================================================================= -->

          <div id="carouselExample" class="carousel slide">
            <div class="carousel-inner">
           
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
              <span class="carousel-control-prev-icon" style="background-color: white;" aria-hidden="true"></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
              <span class="carousel-control-next-icon" style="background-color: white;" aria-hidden="true"></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
          <!-- ================================================================================================ -->

        </div>
        
      </div>
    </div>
  </div>



    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>    



    <script>



        const printDiv = () => {
            console.log('click')
            const contenido = document.querySelector('.contenido-imprimir').innerHTML;
            const contenidoOriginal= document.body.innerHTML;
            document.body.innerHTML = contenido;
            window.print();
            document.body.innerHTML = contenidoOriginal;
       
        }
        

        const printImg = () => {
            
            console.log('click')   
            
            html2canvas(document.body, {
                onrendered (canvas) {
                    var link = document.querySelector('#download');
                    var image = canvas.toDataURL();
                    link.href = image;
                    link.download = 'screenshot.png';
                    link.click();        

                }
            });
        }


        document.getElementById('img_detallado').addEventListener('click', () => {
          // console.log('click');          
          // document.getElementById('img_detallado').style.transform = 'scale(1.9)'
        });

    </script>

    <footer class="footer origen"></footer>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"
      integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"
      integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM"
      crossorigin="anonymous"
    ></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.js"
    ></script>
    <script src="/index.js"></script>

    <script>
      function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
          results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return "";
        return decodeURIComponent(results[2].replace(/\+/g, " "));
      }
      var estacion = getParameterByName("estacion");
      var nombre = getParameterByName("nombre");

      document.getElementById("titulo").innerHTML = nombre;

  

      function activarImagen(e){                
        for(let i of document.getElementsByClassName("carousel-item")){
            i.classList.remove("active");            
        }   
        
        for(let i of document.getElementsByClassName("carousel-item")){            
            if(i.childNodes[1].id.indexOf(e.target.parentElement.id) !== -1){
              i.childNodes[1].parentElement.classList.add("active")
            }
        }        
        $('#exampleModal').modal('show');        
      }

      function check(data) {
        if (data == null) {
          return "Sin información";
        } else {
          return data;
        }
      }

      function capitalLetter(data) {
        if (data != null) {
          return data.charAt(0) + data.slice(1).toLowerCase();
        }else{
          return null;
        }        
      }

      $.ajax({
        type: "get",
        url: url_backend + "/json_detalle_activa",
        data: {
          id: estacion,
        },
        dataType: "json",
        success: async function (result) {
          console.log(result);
          // pintarDatos(result);
          var obj = result[0];

          document.getElementById("nomenclatura_estandarizada").innerHTML = 
            "Nomenclatura Estandarizada " + check(obj.identificador);

          document.getElementById("depto").innerHTML =
            "Departamento: " + check(obj.departamento);
          document.getElementById("muni").innerHTML =
            "Municipio: " + check(obj.municipio);

          document.getElementById("departamento").innerHTML =
            "Departamento: " + check(obj.departamento);
          document.getElementById("municipio").innerHTML =
            "Municipio: " + check(obj.municipio);
       
          document.getElementById("localizacion").innerHTML =
            "Localizacion: " + check(obj.lugar_materializacion);

          document.getElementById("latitud").innerHTML =
            "Latitud (φ): " + check(obj.estacion_latitud);
          document.getElementById("altura").innerHTML =
            "Altura Elipsoidal (Һ): " + check(obj.estacion_altura_elipsoidal);
          document.getElementById("longitud").innerHTML =
            "Longitud (ג): " + check(obj.estacion_longitud);

       

          document.getElementById("tipo_materializacion").innerHTML =
            "Tipo de Monumento: " + check(obj.tipo_materializacion);
          document.getElementById("fecha_materializacion").innerHTML =
            "Fecha Monumentación: " + check(obj.fecha_materializacion);        
          document.getElementById("divipola2").innerHTML =
            "Código Municipio: " + check(obj.codigo);

          conversionCoordenadas(obj.estacion_latitud, obj.estacion_longitud);

            


         

              
          




          let contenidoCarrusel = '';

          var img = document.createElement("img");
          img.src = "https://redgeodesica-cg.igac.gov.co/croquis/" + nombre + "/3";
          contenidoCarrusel += `
              <div class="carousel-item active">
                <img src="${img.src}" id="img_croquis_car"  class="d-block " style="width:500px; height:400px" alt="">
              </div>
          `;
          var src = document.getElementById("img_croquis");
          src.appendChild(img);

          var img = document.createElement("img");
          img.src = "https://redgeodesica-cg.igac.gov.co/croquis/" + nombre + "/2";
          contenidoCarrusel += `
              <div class="carousel-item">
                <img src="${img.src}" id="img_detallado_car" class="d-block" style="width:500px; height:400px" alt="">
              </div>
          `;
          var src = document.getElementById("img_detallado");
          src.appendChild(img);

          var img = document.createElement("img");
          img.src = "https://redgeodesica-cg.igac.gov.co/croquis/" + nombre + "/1";
          contenidoCarrusel += `
              <div class="carousel-item">
                <img src="${img.src}" id="img_perfil_car" class="d-block " style="width:500px; height:400px" alt="">
              </div>
          `;
          var src = document.getElementById("img_perfil");
          src.appendChild(img);

          var img = document.createElement("img");
          img.src = "https://redgeodesica-cg.igac.gov.co/croquis/" + nombre + "/5";
          contenidoCarrusel += `
              <div class="carousel-item">
                <img src="${img.src}" id="img_obstaculos_car" class="d-block" style="width:500px; height:400px" alt="">
              </div>
          `;
          var src = document.getElementById("img_obstaculos");
          src.appendChild(img);

          var img = document.createElement("img");
          img.src = "https://redgeodesica-cg.igac.gov.co/croquis/" + nombre + "/4";
          contenidoCarrusel += `
              <div class="carousel-item">
                <img src="${img.src}" id="img_placa_car" class="d-block" style="width:500px; height:400px" alt="">
              </div>
          `;
          var src = document.getElementById("img_placa");
          src.appendChild(img);

          
          // ======= CARGAR CARRUSEL ==========
            document.querySelector(".carousel-inner").innerHTML = contenidoCarrusel;
          // ===============================




          if (obj.fotos_campo) {
            var cols = obj.fotos_campo.length;

            for (i = 0; i < cols; i++) {
              console.log(obj.fotos_campo[i]);

              $("#fotos").append(
                "<div class'col-md-6>" +
                  "<div class='title'>" +
                  "Foto" +
                  "</div>" +
                  "<div class='item'>" +
                  "<img src='" +
                  obj.fotos_campo[i].archivo +
                  "' alt=''>" +
                  "</div>" +
                  "</div>"
              );
            }
          }

          if (obj.punto_referencia) {
            var cols = obj.punto_referencia.length;

            for (i = 0; i < cols; i++) {
              $("#tbl_puntos tr:last").after(
                "<tr><td>" +
                  (i + 1) +
                  "</td><td>" +
                  obj.punto_referencia[i].objeto +
                  "</td><td>" +
                  obj.punto_referencia[i].azimut +
                  "</td><td>" +
                  obj.punto_referencia[i].distancia +
                  "</td></tr>"
              );
            }
          } else {
            var tableHeaderRowCount = 1;
            var table = document.getElementById("tbl_puntos");
            var rowCount = table.rows.length;
            console.log(rowCount);
            for (var i = tableHeaderRowCount; i < rowCount; i++) {
              table.deleteRow(tableHeaderRowCount);
            }
            $("#tbl_puntos").after(
              "<p style='text-align: center; font-size: 16px'>Sin información</p>"
            );
          }
        },
      });
    </script>

    <script>
      const cargarAccesoGeneral = async () => {
                
        const urlParams = new URLSearchParams(window.location.search);        
        var id = urlParams.get('estacion');
        
        try{
          const res = await fetch(`https://karratha-tawny-frogmouth-xngk.1.us-1.fl0.io/api/pasiva/${id}`);
          const datos = await res.json();
          console.log(datos);
          if(datos) {
            document.querySelector('#acceso_general').innerHTML = check( datos.acceso_general) ;
            document.getElementById("descripcion_detallada").innerHTML =
            " " + check( datos.descripción_detallada);
            document.getElementById("barrio").innerHTML = "Vereda/Barrio: " + check(datos.vereda);
            document.getElementById("observacion").innerHTML = check(datos.observacion);

            document.getElementById("fecha_descripcion").innerHTML += datos.fecha_descripcion == null ? check(datos.fecha_descripcion) : datos.fecha_descripcion.split('T')[0];
            document.getElementById("monumentado_por").innerHTML += check(datos.monumentado_por_1);
            document.getElementById("altura_mts").innerHTML += check(datos.altura_mts);
            document.getElementById("ancho_mts").innerHTML += check(datos.ancho_mts);
            document.getElementById("largo_mts").innerHTML += check(datos.largo_mts);
            document.getElementById("actualizo").innerHTML += check(datos.actualizó);
          }
        } catch(e){console.error(e)}
      }
      cargarAccesoGeneral();

      const conversionCoordenadas = (latitudDec=null, longitudDec=null) => {
        if(!latitudDec || !longitudDec) return;

        let latitud = latitudDec > 0 ? latitudDec : latitudDec * -1;
        let longitud = longitudDec > 0 ? longitudDec : longitudDec * -1;
        

        const latGrados = Math.trunc(latitud)
        const latPartDec = latitud - latGrados;
        let latMin = latPartDec * 60;
        const latSec = ( (latMin - Math.trunc(latMin)) * 60 ).toFixed(5);
        latMin = Math.trunc(latMin);

        // console.log(latGrados, latMin, latSec)


        const longGrados = Math.trunc(longitud);
        const lonPartDec = longitud - longGrados;
        let lonMin = lonPartDec * 60;
        const lonSec = ( (lonMin - Math.trunc(lonMin)) * 60 ).toFixed(5);
        lonMin = Math.trunc(lonMin);

        // console.log(longGrados, lonMin, lonSec)

        let latitudFinal  = latGrados+'° '+latMin+"' "+latSec+'" ';
        let longitudFinal  = longGrados+'° '+lonMin+"' "+lonSec+'" ';

        const latDir = latitudDec > 0 ? 'Norte' : 'Sur';
        const lonDir = longitudDec > 0 ? 'Este' : 'Oeste';

        latitudFinal += latDir;
        longitudFinal += lonDir;

        // console.log(latitudFinal)
        // console.log(longitudFinal)

        document.querySelector('#latitudGrados').innerHTML = `Latitud: ${latitudFinal}`;
        document.querySelector('#longitudGrados').innerHTML = `Longitud:  ${longitudFinal}`;       

      }
    </script>
  </body>
</html>
